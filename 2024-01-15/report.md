我不会平衡树区间修改了。

看起来 T3 已经比较可做了。

考虑 1 操作其实可以拆分成两个操作。

- 对 $a_i \le k$ 的执行 $a_i \gets k - a_i$
- 对 $a_i > k$ 的执行 $a_i \gets a_i - k$

看到是和值域相关的就想到平衡树。

考虑到涉及区间查询。我觉得 FHQ 不如 Splay。

考虑拆分第一种情况为区间加和区间取反符号，即化为 $a_i \gets -a_i + k$。

感觉标记不是很能合并。

不知道做完修改之后怎么维护平衡树的形态。

考虑第一种情况做完过后 $a_i$ 仍然 $\le k$，但是第二种情况，当 $k < a_i \le 2 \times k$ 时，做完操作就会变成第一种情况。

不是很可做。

感觉想乱了。$k$ 是在变的。

标记不能合并。你打新的标记之前要下传所有的标记...

错麻了。

哦草。取反不就是先翻转子树然后打个标记吗。取反貌似可以合并。

考虑统一成减法标记，即打 $-k$ 的减法标记。

一个很唐的想法，我把根 gank 了，然后做 Splay 合并。

为啥会想到根号了。如果说 $k$ 固定，一个 $a_i$ 变成第一种情况就不会变回第二种情况。

不好根号啊。在值域上做。

我能不能把 $k < a_i \le 2 \times k$ 这一段提出来单独做。

不会只有我真小丑吧。
